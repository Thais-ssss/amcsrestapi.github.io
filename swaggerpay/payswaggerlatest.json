{
  "openapi": "3.0.1",
  "info": {
    "title": "AMCS Pay External API",
    "version": "external",
    "description": "# Getting Started\n\n## Document Purpose and Scope\n\nThe AMCS Pay REST API endpoints are technically described in this document. This document's goal is to instruct readers on how to interface with the AMCS Pay REST API.\n\n## About AMCS Pay\n\nAMCS Pay offers waste & recycling operators feature-rich payment services that broaden their ability to compete in a rapidly evolving marketplace. The services include card payments, ACH payments, Google Pay, Apple Pay, and many alternative payment methods. AMCS Pay supports multiple recognized industry partners such as Global Payments, ACI Worldwide etc.\n\n## Communicating to AMCS Pay API\n\nA calling application must first sign up as a Tenant. A private key is created after successful registration and will be used as the Personal Access Token (PAT).\n\nThe Tenant Private Key is then supplied during authentication and authorization through the (\"/authTokens\") endpoint. This creates a cookie, which needs to be tracked in a cookie container. Subsequent calls to the REST API will then use this cookie to authenticate and authorize requests.\n\n<img src=\"diagram/amcspay_multitenant.png\" width=\"689\" height=\"265\">"
  },
  "security": [
    {
      "cookieAuth": []
    }
  ],
  "paths": {
    "/authTokens": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Auth by Private Key",
        "description": "This endpoint is used for authentication and authorisation of a calling application by supplying the Tenant Private Key in the privateKey property. When successful, Platform.PAY.SessionToken is added to the cookie.\n\n## Request\n\n| **Property** | **Description** |\n| --- | --- |\n| PrivateKey | This is a Personal Access Token (PAT), generated during Tenant Registration. |\n\n## Response\n\n| **Property** | **Description** |\n| --- | --- |\n| AuthResult | The authentication and authorization result. Returns \"ok\" if successful otherwise returns \"invalidCredentials\". |\n| Username | The username assigned to the default tenant user. |\n| UserIdentity | The user identity associated to the user. |\n| SysUserId | The ID associated to the user. |\n| UserGuid | The GUID associated to the user. |\n| Companyoutletid | The ID associated to the Company outlet. |\n| CompanyOutletGuid | The GUID associated to the Company outlet. |\n| StayLoggedIn | The boolean flag used when user opts to stay logged in. (usually set in a 'Remember me' checkbox) |",
        "security": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AMCSUserCredentials"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Success",
            "headers": {
              "Set-Cookie": {
                "schema": {
                  "type": "string",
                  "example": "Platform.PAY.SessionToken=abcde12345; Path=/; HttpOnly",
                  "description": "Subsequent calls to the REST API will use this cookie to authenticate and authorize requests."
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AMCSLoginResponse"
                }
              }
            }
          }
        }
      }
    },
    "ExternalTransaction/OneOff": {
      "post": {
        "tags": [
          "ExternalTransaction"
        ],
        "summary": "OneOff Payment",
        "description": "This endpoint is used to initiate the iframe payment.\n\n## Request\n\n| Property                  | Description  |\r\n| ------------------------- | ------------------------------------------------------------------------|\r\n| RequestType                      |Request Type can be any of \"OneOffPayment\", \"OneOffPaymentAndTokenization\", \"Tokenization\".                            |\r\n| PaymentType               | Payment Type can be any of \"Card\", \"ACH \", \"GooglePay\", \"ApplePay\" .                      |\r\n| TransactionOrigin                 | Transaction Origin can be any of \"Moto\", \"Ecom\"        |\r\n| CallerIdentifier               | The CallerIdentifier associated to the Payment request.             |\r\n| CallerTransactionId               | The CallerTransactionId associated to the Payment request.        |\r\n| CallerIPAddress               |CallerIP Address associated to the the payment request.        |\r\n| RequestTimeStamp               |The RequestTimeStamp associated to the payment request in ISO format (YYYY-MM-DD).        |\r\n| ProvideType                   |Provide Type can be any of \"ACICards\", \"ACIElectronic\", \"Heartland\", \"MerchantPartners\",  \"Payment Express\", \"Realex\"        |\r\n| TransactionAmount                     |The amount associated to the payment request.        |\r\n| HPPTransactionRequest                         | The HPPTransaction Request associated to the customer.                |\r\n| CallerTransactionId                 |The CallerTransactionId associated with the Payment response.        |\r\n| AmcsPayReference               | The  Amcs Pay Reference associated to the payment response.        |\r\n| ResponseTimestamp                 |The ResponseTimestamp associated to the payment response in ISO format (YYYY-MM-DD).            |\r\n| TransactionStatus           |Transaction Status can be any of \"Initiated\", \"Success\", \"Failure\", \"Timeout\", \"Cancelled\"|\n\n## Response\n\n| **Property** | **Description** |\n| --- | --- |\n| AmcsPayUrl | The iframe url to load. | AmcsPayTransactionGuid | The GUID associated to the Iframe payment request. |\n| StatusCode | The status associated to the payment.",
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AMCSInitiatePaymentResponse"
                }
              }
            }
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AMCSInitiatePaymentRequest"
              }
            }
          }
        }
      }
    },
    "ExternalTransaction/Poll": {
      "post": {
        "tags": [
          "ExternalTransaction"
        ],
        "summary": "Poll Payment",
        "description": "This endpoint is used to poll the payment initiated after interaction through an iframe.\n\n## Request\n\n| **Property** | **Description** |\n| --- | --- |\n| AmcsPayTransactionGuid | The GUID associated to the Iframe payment request. |\n\n## Response\n\n| **Property** | **Description** |\n| --- | --- |\n| CallerTransactionId | The GUID associated to the payment request. |\n| ProviderReference | The reference number associated to the payment provider. |\n| AmcsPayReference | The ID associated to the payment reference sent by the provider in the payload response. |\n| ResponseCode | The response code associated to the response. |\n| Notes | More information associated to the payment. |\n| ProviderAuthCode | The authorization code associated to the payment provider. |\n| AdditionalProviderData | More information associated to the payment provider. |\n| ResponseTimeStamp | The timestamp of the payment response payload. |\n| StatusCode | The status associated to the payment.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AMCSPayPollPaymentRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AMCSPayPollPaymentResponse"
                }
              }
            }
          }
        }
      }
    },
    "Mobills/Ivr/Pay/GetCustomerInvoiceDetails": {
      "post": {
        "tags": [
          "Mobills IVR"
        ],
        "summary": "Get Customer Invoice Details",
        "description": "This endpoint creates a record in payment transaction table.\n\n## Request\n\n| Property                  | Description  |\r\n| ------------------------- | ------------------------------------------------------------------------|\r\n| CustomerARCode                      | The account code used for Accounts Receivable.        (AMCS will provide the account ARCode)                             |\r\n| Channel               | Channel can be only MOBILL OR IVR                         | \n\n ## Response\n\n| Property                  | Description  |\r\n| ------------------------- | ------------------------------------------------------------------------|\r\n| CustomerGuid                 | The GUID associated to the customer.        |\r\n| CustomerName               |The customer's name.        |\r\n| CustomerBalance               |The amount associated to the payment.        |\r\n| CustomerCurrency               | Customer Currency associated with the Customer account.        |\r\n| InvoiceDetails               |It will show all the invoices associated with the account               |\r\n| InvoiceNumber                   |The invoice number associated to the invoice. Filterable.        |\r\n| InvoiceGUID                     |The GUID associated to the invoice.        |\r\n| InvoiceDate                     |The invoiceDate associated to the invoice in ISO format (YYYY-MM-DD).        |\r\n| ZipCode                         |Zip code is associated with the account               |\r\n| InvoiceDueDate                  |The dueDate associated to the invoice in ISO format (YYYY-MM-DD).        |\r\n| UnallocatedAmount               |The Unallocated Amount on the customers account.        |\r\n| InvoiceCurrency                 |Invoice Currency asscoaited with the customer account             |\r\n| TransactionReference            |Transaction Reference associated with account                 |\r\n| ZipCode                         |ZipCode associated with the account address                                |\r\n| InvoiceDate                     |The invoiceDate associated to the invoice in ISO format (YYYY-MM-DD).        |\r\n| LastPaymentDate                 |When the last payment was made                     |\r\n| MakePaymentLink                 |It shows the payment link (if any invoice available)                     |\r\n| IsActive                 |Whether the customer is active              |\r\n| MobillsEnrollment               |Whether the mobills enrollment is active.              |\r\n| GUID         |Guid associated with the account",
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AMCSPayMobillsIvrResponse"
                }
              }
            }
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AMCSMobillsIvrRequest"
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "cookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "Platform.PAY.SessionToken"
      }
    },
    "schemas": {
      "AMCSUserCredentials": {
        "type": "object",
        "properties": {
          "privateKey": {
            "type": "string",
            "nullable": true,
            "example": "1zEFtwJQE0cmKUE3AvnzBbm5"
          }
        },
        "additionalProperties": false
      },
      "AMCSLoginResponse": {
        "type": "object",
        "properties": {
          "authResult": {
            "type": "string",
            "nullable": true,
            "example": "ok"
          },
          "userName": {
            "type": "string",
            "nullable": true,
            "example": "ADMIN01"
          },
          "userIdentity": {
            "type": "string",
            "nullable": true,
            "example": "ADMIN"
          },
          "sysUserId": {
            "type": "integer",
            "format": "int32",
            "nullable": true,
            "example": 3
          },
          "userGuid": {
            "type": "string",
            "format": "uuid",
            "nullable": true,
            "example": "607e37cd-4f51-4148-af23-4459b74fc3b2"
          },
          "companyOutletId": {
            "type": "integer",
            "format": "int32",
            "nullable": true,
            "example": 10
          },
          "companyOutletGuid": {
            "type": "string",
            "format": "uuid",
            "nullable": true,
            "example": "5feaaae5-7733-4e45-ac39-87d46cf138e0"
          },
          "stayLoggedIn": {
            "type": "boolean",
            "example": false
          }
        }
      },
      "AMCSMobillsIvrRequest": {
        "type": "object",
        "required": [
          "customerARCode",
          "channel"
        ],
        "properties": {
          "customerARCode": {
            "type": "string",
            "example": "ACC1007",
            "nullable": false
          },
          "channel": {
            "type": "string",
            "example": "MOBILL / IVR",
            "nullable": false
          }
        },
        "additionalProperties": false
      },
      "AMCSInitiatePaymentRequest": {
        "type": "object",
        "required": [
          "requestType",
          "paymentType",
          "transctionOriginEnum",
          "provideType",
          "transactionAmount",
          "callerIdentifier",
          "callerTransactionId"
        ],
        "properties": {
          "requestType": {
            "type": "string",
            "enum": [
              "oneOffPayment",
              "oneOffPaymentAndTokenization",
              "Tokenization"
            ],
            "nullable": false
          },
          "paymentType": {
            "type": "string",
            "enum": [
              "CARD",
              "ACH",
              "GOOGLEPAY",
              "APPLEPAY"
            ],
            "nullable": false
          },
          "transctionOriginEnum": {
            "type": "string",
            "enum": [
              "MOTO",
              "ECOM"
            ],
            "nullable": false
          },
          "callerIdentifier": {
            "type": "string",
            "nullable": false
          },
          "callerTransactionId": {
            "type": "string",
            "nullable": false
          },
          "callerIPAddress": {
            "type": "string",
            "nullable": false
          },
          "requestTimestamp": {
            "type": "Date-time",
            "nullable": false
          },
          "provideType": {
            "type": "string",
            "enum": [
              "ACICards",
              "ACIElectronic",
              "Heartland",
              "MerchantPartners",
              "PaymentExpress",
              "Realex"
            ]
          },
          "transactionAmount": {
            "type": "array",
            "nullable": false,
            "allOf": [
              {
                "$ref": "#/components/schemas/AMCSPayAmount"
              }
            ]
          },
          "hPPTransactionRequest": {
            "type": "array",
            "nullable": false,
            "allOf": [
              {
                "$ref": "#/components/schemas/AmcsHPPTransactionRequest"
              }
            ]
          }
        }
      },
      "AMCSPayMobillsIvrResponse": {
        "type": "object",
        "properties": {
          "details": {
            "$ref": "#/components/schemas/AMCSPayMobillsIvrResponseDetail"
          }
        },
        "additionalProperties": false
      },
      "AMCSPayHeader": {
        "required": [
          "ClientProvidedGuid",
          "RequestType",
          "StatusCode",
          "BecameStateAt"
        ],
        "type": "object",
        "properties": {
          "Guid": {
            "type": "string",
            "format": "uuid",
            "nullable": true
          },
          "ClientProvidedGuid": {
            "type": "string",
            "format": "uuid",
            "nullable": false
          },
          "requestTypeEnum": {
            "type": "string",
            "enum": [
              "Payment",
              "CardAuthentication",
              "Refund",
              "Ivr",
              "AutoPay",
              "Test",
              "DeleteProfile",
              "Terminal"
            ],
            "nullable": false
          },
          "statusCodeEnum": {
            "type": "string",
            "enum": [
              "Initiated",
              "Success",
              "Failure",
              "InvalidCardInformation",
              "Exception"
            ],
            "nullable": false
          },
          "BecameStateAt": {
            "type": "string",
            "format": "datetime",
            "nullable": false
          }
        }
      },
      "AMCSAddress": {
        "type": "object",
        "properties": {
          "addressType": {
            "enum": [
              "Billing",
              "Shipping"
            ],
            "type": "string"
          },
          "streetAddress1": {
            "type": "string",
            "nullable": true
          },
          "streetAddress2": {
            "type": "string",
            "nullable": true
          },
          "streetAddress3": {
            "type": "string",
            "nullable": true
          },
          "city": {
            "type": "string",
            "nullable": true
          },
          "state": {
            "type": "string",
            "nullable": true
          },
          "postalCode": {
            "type": "string",
            "nullable": true
          },
          "country": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "AMCSListItem": {
        "type": "object",
        "required": [
          "Guid"
        ],
        "properties": {
          "Guid": {
            "type": "string",
            "format": "uuid"
          },
          "Description": {
            "type": "string"
          }
        }
      },
      "AMCSPayMobillsIvrRequestDetail": {
        "required": [
          "CustomerId",
          "ExternalChannel"
        ],
        "type": "object",
        "properties": {
          "CustomerId": {
            "minLength": 7,
            "type": "string"
          },
          "ExternalChannel": {
            "type": "string"
          }
        }
      },
      "AMCSPayMobillsIvrResponseDetail": {
        "type": "object",
        "properties": {
          "customerGuid": {
            "format": "uuid",
            "type": "string",
            "example": "00000000-0000-0000-0000-000000000000",
            "nullable": false
          },
          "customerName": {
            "type": "string",
            "example": "Mark Smith",
            "nullable": false
          },
          "customerBalance": {
            "type": "integer",
            "example": "120.95",
            "nullable": true
          },
          "customerCurrency": {
            "type": "string",
            "example": "EUR"
          },
          "invoiceDetails": {
            "type": "array",
            "nullable": true,
            "allOf": [
              {
                "$ref": "#/components/schemas/AmcsInvoiceDetails"
              }
            ]
          },
          "transactionReference": {
            "type": "string",
            "format": "uuid",
            "example": "00000000-0000-0000-0000-000000000000",
            "nullable": true
          },
          "zipCode": {
            "type": "string",
            "example": "00501",
            "nullable": true
          },
          "dueDate": {
            "type": "string",
            "example": "YYYY-MM-DD",
            "nullable": true
          },
          "invoiceDate": {
            "type": "string",
            "example": "YYYY-MM-DD",
            "nullable": true
          },
          "lastPaymentDate": {
            "type": "string",
            "example": "YYYY-MM-DD",
            "nullable": true
          },
          "lastPaymentAmount": {
            "type": "string",
            "example": "155.50",
            "nullable": true
          },
          "makePaymentLink": {
            "format": "url",
            "type": "string",
            "example": "https://localhost/paybylink?key=092159d8-9e57-41a5-af6c-745bd45ff2f7",
            "nullable": true
          },
          "isActive": {
            "type": "boolean",
            "example": "true"
          },
          "mobillsEnrollment": {
            "type": "boolean",
            "example": "true"
          },
          "guid": {
            "format": "uuid",
            "type": "string",
            "example": "00000000-0000-0000-0000-000000000000",
            "nullable": true
          }
        }
      },
      "AmcsHPPTransactionRequest": {
        "type": "object",
        "properties": {
          "completionURL": {
            "type": "string",
            "format": "url",
            "example": "",
            "nullable": false
          },
          "address": {
            "type": "Arrays",
            "allOf": [
              {
                "$ref": "#/components/schemas/AMCSPayAddress"
              }
            ]
          },
          "contact": {
            "type": "Arrays",
            "allOf": [
              {
                "$ref": "#/components/schemas/AMCSPayContact"
              }
            ]
          },
          "IsRequestValid": {
            "type": "boolean",
            "example": "true"
          }
        }
      },
      "AmcsInvoiceDetails": {
        "type": "object",
        "properties": {
          "invoiceNumber": {
            "type": "string",
            "example": "INV001"
          },
          "invoiceGUID": {
            "format": "uuid",
            "example": "00000000-0000-0000-0000-000000000000",
            "type": "string"
          },
          "invoiceDate": {
            "type": "string",
            "example": "YYYY-MM-DD"
          },
          "zipCode": {
            "type": "string",
            "example": "00501"
          },
          "invoiceDueDate": {
            "type": "string",
            "example": "YYYY-MM-DD"
          },
          "unallocatedAmount": {
            "type": "integer",
            "example": "120.95"
          },
          "invoiceCurrency": {
            "type": "string",
            "example": "EUR"
          }
        },
        "additionalProperties": false
      },
      "AMCSResponseStatusEnum": {
        "type": "string",
        "enum": [
          "Initiated",
          "Success",
          "Failure",
          "Timeout",
          "Cancelled"
        ],
        "example": "Success"
      },
      "AMCSInitiatePaymentResponse": {
        "type": "object",
        "properties": {
          "amcsPayUrl": {
            "format": "url",
            "type": "string",
            "example": "https://localhost/paybylink?key=092159d8-9e57-41a5-af6c-745bd45ff2f7",
            "nullable": false
          },
          "amcsPayTransactionGuid": {
            "format": "uuid",
            "example": "00000000-0000-0000-0000-000000000000",
            "type": "string",
            "nullable": false
          },
          "statusCode": {
            "type": "object",
            "properties": {
              "ResponseStatusEnum": {
                "$ref": "#/components/schemas/AMCSResponseStatusEnum"
              }
            },
            "nullable": false
          }
        }
      },
      "AMCSPayContact": {
        "type": "object",
        "properties": {
          "contactType": {
            "enum": [
              "Email",
              "Mobile"
            ]
          },
          "contactValue": {
            "type": "string",
            "example": "089748588788",
            "nullable": false
          }
        }
      },
      "AMCSPayAmount": {
        "type": "object",
        "properties": {
          "principalAmount": {
            "type": "Decimal",
            "example": "40",
            "nullable": false
          },
          "serviceFeeAmount": {
            "type": "Decimal",
            "example": "10.20",
            "nullable": false
          },
          "currency": {
            "type": "string",
            "example": "EUR",
            "nullable": false
          }
        }
      },
      "AMCSPayAddress": {
        "type": "object",
        "properties": {
          "addressType": {
            "enum": [
              "Billing",
              "Shipping"
            ]
          },
          "contactValue": {
            "type": "string",
            "example": "089789999999",
            "nullable": true
          },
          "addressLine1": {
            "type": "string",
            "example": "27, Longwood Avenue",
            "nullable": true
          },
          "addressLine2": {
            "type": "string",
            "example": "South Circular",
            "nullable": true
          },
          "addressLine3": {
            "type": "string",
            "example": "Road Dublin-08",
            "nullable": true
          },
          "city": {
            "type": "string",
            "example": "Dublin",
            "nullable": true
          },
          "countryOrState": {
            "type": "string",
            "example": "Munster",
            "nullable": true
          },
          "postCode": {
            "type": "string",
            "example": "12345",
            "nullable": true
          },
          "country": {
            "type": "string",
            "example": "Ireland",
            "nullable": true
          },
          "countryCallingCode": {
            "type": "string",
            "example": "+353",
            "nullable": true
          }
        }
      },
      "AMCSPayPollPaymentRequest": {
        "required": [
          "amcsPayTransactionGuid"
        ],
        "type": "object",
        "properties": {
          "amcsPayTransactionGuid": {
            "type": "string",
            "description": "The GUID associated to the payment request.",
            "format": "uuid",
            "example": "204ba071-1e75-48c6-8a08-aedf00b3b648"
          }
        },
        "additionalProperties": false
      },
      "AMCSPayPollPaymentResponse": {
        "type": "object",
        "properties": {
          "callerTransactionId": {
            "type": "string",
            "format": "uuid",
            "description": "The GUID associated to the payment request.",
            "example": "204ba071-1e75-48c6-8a08-aedf00b3b648"
          },
          "providerReference": {
            "type": "string",
            "description": "The reference number associated to the payment provider.",
            "nullable": true,
            "example": ""
          },
          "amcsPayReference": {
            "type": "string",
            "description": "The ID associated to the payment reference sent by the provider in the payload response.",
            "nullable": true,
            "example": ""
          },
          "responseCode": {
            "type": "string",
            "description": "The status code associated to the response.",
            "nullable": true,
            "example": "OK"
          },
          "notes": {
            "type": "string",
            "description": "More information associated to the payment.",
            "nullable": true,
            "example": ""
          },
          "providerAuthCode": {
            "type": "string",
            "description": "The authorization code associated to the payment provider.",
            "nullable": true,
            "example": ""
          },
          "additionalProviderData": {
            "type": "object",
            "description": "More information associated to the payment provider.",
            "additionalProperties": true
          },
          "responseTimeStamp": {
            "type": "string",
            "description": "The timestamp of the payment response payload.",
            "format": "datetime",
            "example": "2022-07-27 18:54:18.6767965 +08:00"
          },
          "statusCode": {
            "type": "object",
            "properties": {
              "ResponseStatusEnum": {
                "$ref": "#/components/schemas/AMCSResponseStatusEnum"
              }
            },
            "nullable": false
          }
        },
        "additionalProperties": false
      }
    }
  }
}
